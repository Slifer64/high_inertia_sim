
arma::mat lwr4p_jacob(const arma::vec &q)
{

  arma::vec sinq(7), cosq(7);

  for (int i=0; i<7; i++)
  {
    c(i) = std::cos(q(i));
    s(i) = std::sin(q(i));
  }

  arma::mat Ja(6,7);

  Ja(0,0)   =  0.4*s(0)*s(1)+0.39*c(3)*s(0)*s(1)-0.39*c(0)*s(2)*s(3)-0.39*c(1)*c(2)*s(0)*s(3)+0.088*c(3)*c(5)*s(0)*s(1)-0.088*c(0)*c(5)*s(2)*s(3)+0.088*c(0)*c(2)*s(4)*s(5)-0.088*c(1)*s(0)*s(2)*s(4)*s(5)+0.088*c(4)*s(0)*s(1)*s(3)*s(5)-0.088*c(1)*c(2)*c(5)*s(0)*s(3)+0.088*c(0)*c(3)*c(4)*s(2)*s(5)+0.088*c(1)*c(2)*c(3)*c(4)*s(0)*s(5);
  Ja(0,1)   = -c(0)*(0.4*c(1)+0.39*c(1)*c(3)+0.088*c(1)*c(3)*c(5)+0.39*c(2)*s(1)*s(3)+0.088*c(2)*c(5)*s(1)*s(3)+0.088*c(1)*c(4)*s(3)*s(5)+0.088*s(1)*s(2)*s(4)*s(5)-0.088*c(2)*c(3)*c(4)*s(1)*s(5));
  Ja(0,2)   =  0.088*c(0)*c(1)*c(2)*s(4)*s(5)-0.39*c(2)*s(0)*s(1)*s(1)*s(3)-0.39*c(0)*c(1)*s(2)*s(3)-0.088*c(1)*c(1)*c(2)*c(5)*s(0)*s(3)-0.088*c(2)*c(5)*s(0)*s(1)*s(1)*s(3)-0.088*c(1)*c(1)*s(0)*s(2)*s(4)*s(5)-0.088*s(0)*s(1)*s(1)*s(2)*s(4)*s(5)-0.088*c(0)*c(1)*c(5)*s(2)*s(3)-0.39*c(1)*c(1)*c(2)*s(0)*s(3)+0.088*c(0)*c(1)*c(3)*c(4)*s(2)*s(5)+0.088*c(1)*c(1)*c(2)*c(3)*c(4)*s(0)*s(5)+0.088*c(2)*c(3)*c(4)*s(0)*s(1)*s(1)*s(5);
  Ja(0,3)   =  0.39*c(0)*c(2)*c(2)*s(1)*s(3)-0.39*c(1)*c(1)*c(3)*s(0)*s(2)+0.39*c(0)*s(1)*s(2)*s(2)*s(3)-0.39*c(3)*s(0)*s(1)*s(1)*s(2)+0.39*c(0)*c(1)*c(2)*c(3)+0.088*c(0)*c(2)*c(2)*c(5)*s(1)*s(3)-0.088*c(1)*c(1)*c(3)*c(5)*s(0)*s(2)+0.088*c(0)*c(5)*s(1)*s(2)*s(2)*s(3)-0.088*c(3)*c(5)*s(0)*s(1)*s(1)*s(2)+0.088*c(0)*c(1)*c(2)*c(3)*c(5)-0.088*c(4)*s(0)*s(1)*s(1)*s(2)*s(3)*s(5)+0.088*c(0)*c(1)*c(2)*c(4)*s(3)*s(5)-0.088*c(0)*c(2)*c(2)*c(3)*c(4)*s(1)*s(5)-0.088*c(0)*c(3)*c(4)*s(1)*s(2)*s(2)*s(5)-0.088*c(1)*c(1)*c(4)*s(0)*s(2)*s(3)*s(5);
  Ja(0,4)   =  s(5)*(0.088*c(4)*s(0)*c(1)*c(1)*c(2)*c(3)*c(3)+0.088*c(4)*s(0)*c(1)*c(1)*c(2)*s(3)*s(3)-0.088*s(0)*s(4)*c(1)*c(1)*c(3)*s(2)+0.088*c(0)*s(4)*c(1)*c(2)*c(3)+0.088*c(0)*c(4)*c(1)*c(3)*c(3)*s(2)+0.088*c(0)*c(4)*c(1)*s(2)*s(3)*s(3)+0.088*c(0)*s(4)*c(2)*c(2)*s(1)*s(3)+0.088*c(4)*s(0)*c(2)*c(3)*c(3)*s(1)*s(1)+0.088*c(4)*s(0)*c(2)*s(1)*s(1)*s(3)*s(3)-0.088*s(0)*s(4)*c(3)*s(1)*s(1)*s(2)+0.088*c(0)*s(4)*s(1)*s(2)*s(2)*s(3));
  Ja(0,5)   =  0.088*c(5)*s(0)*c(1)*c(1)*c(2)*c(3)*c(3)*s(4)+0.088*c(5)*s(0)*c(1)*c(1)*c(2)*s(3)*s(3)*s(4)+0.088*c(5)*s(0)*c(1)*c(1)*c(3)*c(4)*s(2)+0.088*s(0)*s(5)*c(1)*c(1)*c(4)*c(4)*s(2)*s(3)+0.088*s(0)*s(5)*c(1)*c(1)*s(2)*s(3)*s(4)*s(4)-0.088*c(0)*c(5)*c(1)*c(2)*c(3)*c(4)-0.088*c(0)*s(5)*c(1)*c(2)*c(4)*c(4)*s(3)-0.088*c(0)*s(5)*c(1)*c(2)*s(3)*s(4)*s(4)+0.088*c(0)*c(5)*c(1)*c(3)*c(3)*s(2)*s(4)+0.088*c(0)*c(5)*c(1)*s(2)*s(3)*s(3)*s(4)+0.088*c(0)*s(5)*c(2)*c(2)*c(3)*c(4)*c(4)*s(1)+0.088*c(0)*s(5)*c(2)*c(2)*c(3)*s(1)*s(4)*s(4)-0.088*c(0)*c(5)*c(2)*c(2)*c(4)*s(1)*s(3)+0.088*c(5)*s(0)*c(2)*c(3)*c(3)*s(1)*s(1)*s(4)+0.088*c(5)*s(0)*c(2)*s(1)*s(1)*s(3)*s(3)*s(4)+0.088*c(0)*s(5)*c(3)*c(4)*c(4)*s(1)*s(2)*s(2)+0.088*c(5)*s(0)*c(3)*c(4)*s(1)*s(1)*s(2)+0.088*c(0)*s(5)*c(3)*s(1)*s(2)*s(2)*s(4)*s(4)+0.088*s(0)*s(5)*c(4)*c(4)*s(1)*s(1)*s(2)*s(3)-0.088*c(0)*c(5)*c(4)*s(1)*s(2)*s(2)*s(3)+0.088*s(0)*s(5)*s(1)*s(1)*s(2)*s(3)*s(4)*s(4);
  Ja(0,6)   =  0;
  Ja(1,0)   =  0.39*c(0)*c(1)*c(2)*s(3)-0.39*c(0)*c(3)*s(1)-0.39*s(0)*s(2)*s(3)-0.4*c(0)*s(1)-0.088*c(0)*c(3)*c(5)*s(1)-0.088*c(5)*s(0)*s(2)*s(3)+0.088*c(2)*s(0)*s(4)*s(5)+0.088*c(0)*c(1)*s(2)*s(4)*s(5)-0.088*c(0)*c(4)*s(1)*s(3)*s(5)+0.088*c(3)*c(4)*s(0)*s(2)*s(5)+0.088*c(0)*c(1)*c(2)*c(5)*s(3)-0.088*c(0)*c(1)*c(2)*c(3)*c(4)*s(5);
  Ja(1,1)   = -s(0)*(0.4*c(1)+0.39*c(1)*c(3)+0.088*c(1)*c(3)*c(5)+0.39*c(2)*s(1)*s(3)+0.088*c(2)*c(5)*s(1)*s(3)+0.088*c(1)*c(4)*s(3)*s(5)+0.088*s(1)*s(2)*s(4)*s(5)-0.088*c(2)*c(3)*c(4)*s(1)*s(5));
  Ja(1,2)   =  0.39*c(0)*c(1)*c(1)*c(2)*s(3)+0.39*c(0)*c(2)*s(1)*s(1)*s(3)-0.39*c(1)*s(0)*s(2)*s(3)-0.088*c(1)*c(5)*s(0)*s(2)*s(3)+0.088*c(1)*c(2)*s(0)*s(4)*s(5)+0.088*c(0)*c(1)*c(1)*c(2)*c(5)*s(3)+0.088*c(0)*c(2)*c(5)*s(1)*s(1)*s(3)+0.088*c(0)*c(1)*c(1)*s(2)*s(4)*s(5)+0.088*c(0)*s(1)*s(1)*s(2)*s(4)*s(5)+0.088*c(1)*c(3)*c(4)*s(0)*s(2)*s(5)-0.088*c(0)*c(1)*c(1)*c(2)*c(3)*c(4)*s(5)-0.088*c(0)*c(2)*c(3)*c(4)*s(1)*s(1)*s(5);
  Ja(1,3)   =  0.39*c(0)*c(1)*c(1)*c(3)*s(2)+0.39*c(0)*c(3)*s(1)*s(1)*s(2)+0.39*c(2)*c(2)*s(0)*s(1)*s(3)+0.39*s(0)*s(1)*s(2)*s(2)*s(3)+0.39*c(1)*c(2)*c(3)*s(0)+0.088*c(0)*c(1)*c(1)*c(3)*c(5)*s(2)+0.088*c(0)*c(3)*c(5)*s(1)*s(1)*s(2)+0.088*c(2)*c(2)*c(5)*s(0)*s(1)*s(3)+0.088*c(5)*s(0)*s(1)*s(2)*s(2)*s(3)+0.088*c(1)*c(2)*c(3)*c(5)*s(0)+0.088*c(1)*c(2)*c(4)*s(0)*s(3)*s(5)+0.088*c(0)*c(1)*c(1)*c(4)*s(2)*s(3)*s(5)-0.088*c(2)*c(2)*c(3)*c(4)*s(0)*s(1)*s(5)+0.088*c(0)*c(4)*s(1)*s(1)*s(2)*s(3)*s(5)-0.088*c(3)*c(4)*s(0)*s(1)*s(2)*s(2)*s(5);
  Ja(1,4)   =  s(5)*(0.088*c(0)*s(4)*c(1)*c(1)*c(3)*s(2)-0.088*c(0)*c(4)*c(1)*c(1)*c(2)*s(3)*s(3)-0.088*c(0)*c(4)*c(1)*c(1)*c(2)*c(3)*c(3)+0.088*s(0)*s(4)*c(1)*c(2)*c(3)+0.088*c(4)*s(0)*c(1)*c(3)*c(3)*s(2)+0.088*c(4)*s(0)*c(1)*s(2)*s(3)*s(3)+0.088*s(0)*s(4)*c(2)*c(2)*s(1)*s(3)-0.088*c(0)*c(4)*c(2)*c(3)*c(3)*s(1)*s(1)-0.088*c(0)*c(4)*c(2)*s(1)*s(1)*s(3)*s(3)+0.088*c(0)*s(4)*c(3)*s(1)*s(1)*s(2)+0.088*s(0)*s(4)*s(1)*s(2)*s(2)*s(3));
  Ja(1,5)   =  0.088*c(5)*s(0)*c(1)*c(3)*c(3)*s(2)*s(4)-0.088*c(0)*c(5)*c(1)*c(1)*c(2)*s(3)*s(3)*s(4)-0.088*c(0)*c(5)*c(1)*c(1)*c(3)*c(4)*s(2)-0.088*c(0)*s(5)*c(1)*c(1)*c(4)*c(4)*s(2)*s(3)-0.088*c(0)*s(5)*c(1)*c(1)*s(2)*s(3)*s(4)*s(4)-0.088*c(5)*s(0)*c(1)*c(2)*c(3)*c(4)-0.088*s(0)*s(5)*c(1)*c(2)*c(4)*c(4)*s(3)-0.088*s(0)*s(5)*c(1)*c(2)*s(3)*s(4)*s(4)-0.088*c(0)*c(5)*c(1)*c(1)*c(2)*c(3)*c(3)*s(4)+0.088*c(5)*s(0)*c(1)*s(2)*s(3)*s(3)*s(4)+0.088*s(0)*s(5)*c(2)*c(2)*c(3)*c(4)*c(4)*s(1)+0.088*s(0)*s(5)*c(2)*c(2)*c(3)*s(1)*s(4)*s(4)-0.088*c(5)*s(0)*c(2)*c(2)*c(4)*s(1)*s(3)-0.088*c(0)*c(5)*c(2)*c(3)*c(3)*s(1)*s(1)*s(4)-0.088*c(0)*c(5)*c(2)*s(1)*s(1)*s(3)*s(3)*s(4)+0.088*s(0)*s(5)*c(3)*c(4)*c(4)*s(1)*s(2)*s(2)-0.088*c(0)*c(5)*c(3)*c(4)*s(1)*s(1)*s(2)+0.088*s(0)*s(5)*c(3)*s(1)*s(2)*s(2)*s(4)*s(4)-0.088*c(0)*s(5)*c(4)*c(4)*s(1)*s(1)*s(2)*s(3)-0.088*c(5)*s(0)*c(4)*s(1)*s(2)*s(2)*s(3)-0.088*c(0)*s(5)*s(1)*s(1)*s(2)*s(3)*s(4)*s(4);
  Ja(1,6)   =  0;
  Ja(2,0)   =  0;
  Ja(2,1)   = -(c(0)*c(0)+s(0)*s(0))*(0.4*s(1)+0.39*c(3)*s(1)-0.39*c(1)*c(2)*s(3)+0.088*c(3)*c(5)*s(1)-0.088*c(1)*c(2)*c(5)*s(3)-0.088*c(1)*s(2)*s(4)*s(5)+0.088*c(4)*s(1)*s(3)*s(5)+0.088*c(1)*c(2)*c(3)*c(4)*s(5));
  Ja(2,2)   = -s(1)*(c(0)*c(0)+s(0)*s(0))*(0.39*s(2)*s(3)+0.088*c(5)*s(2)*s(3)-0.088*c(2)*s(4)*s(5)-0.088*c(3)*c(4)*s(2)*s(5));
  Ja(2,3)   =  (c(0)*c(0)+s(0)*s(0))*(0.39*c(2)*c(3)*s(1)-0.39*c(1)*c(2)*c(2)*s(3)-0.39*c(1)*s(2)*s(2)*s(3)-0.088*c(1)*c(2)*c(2)*c(5)*s(3)-0.088*c(1)*c(5)*s(2)*s(2)*s(3)+0.088*c(2)*c(3)*c(5)*s(1)+0.088*c(2)*c(4)*s(1)*s(3)*s(5)+0.088*c(1)*c(2)*c(2)*c(3)*c(4)*s(5)+0.088*c(1)*c(3)*c(4)*s(2)*s(2)*s(5));
  Ja(2,4)   =  s(5)*(c(0)*c(0)+s(0)*s(0))*(0.088*s(1)*s(4)*c(2)*c(3)-0.088*c(1)*s(4)*c(2)*c(2)*s(3)+0.088*c(4)*s(1)*c(3)*c(3)*s(2)-0.088*c(1)*s(4)*s(2)*s(2)*s(3)+0.088*c(4)*s(1)*s(2)*s(3)*s(3));
  Ja(2,5)   = -(c(0)*c(0)+s(0)*s(0))*(0.088*c(1)*s(5)*c(2)*c(2)*c(3)*c(4)*c(4)+0.088*c(1)*s(5)*c(2)*c(2)*c(3)*s(4)*s(4)-0.088*c(1)*c(5)*c(2)*c(2)*c(4)*s(3)+0.088*c(5)*s(1)*c(2)*c(3)*c(4)+0.088*s(1)*s(5)*c(2)*c(4)*c(4)*s(3)+0.088*s(1)*s(5)*c(2)*s(3)*s(4)*s(4)-0.088*c(5)*s(1)*c(3)*c(3)*s(2)*s(4)+0.088*c(1)*s(5)*c(3)*c(4)*c(4)*s(2)*s(2)+0.088*c(1)*s(5)*c(3)*s(2)*s(2)*s(4)*s(4)-0.088*c(1)*c(5)*c(4)*s(2)*s(2)*s(3)-0.088*c(5)*s(1)*s(2)*s(3)*s(3)*s(4));
  Ja(2,6)   =  0;
  Ja(3,0)   =  0;
  Ja(3,1)   =  s(0);
  Ja(3,2)   = -c(0)*s(1);
  Ja(3,3)   = -c(2)*s(0)-c(0)*c(1)*s(2);
  Ja(3,4)   =  c(0)*c(1)*c(2)*s(3)-s(0)*s(2)*s(3)-c(0)*c(3)*s(1);
  Ja(3,5)   =  c(2)*c(4)*s(0)+c(0)*c(1)*c(4)*s(2)+c(0)*s(1)*s(3)*s(4)-c(3)*s(0)*s(2)*s(4)+c(0)*c(1)*c(2)*c(3)*s(4);
  Ja(3,6)   =  c(2)*s(0)*s(4)*s(5)-c(5)*s(0)*s(2)*s(3)-c(0)*c(3)*c(5)*s(1)+c(0)*c(1)*s(2)*s(4)*s(5)-c(0)*c(4)*s(1)*s(3)*s(5)+c(3)*c(4)*s(0)*s(2)*s(5)+c(0)*c(1)*c(2)*c(5)*s(3)-c(0)*c(1)*c(2)*c(3)*c(4)*s(5);
  Ja(4,0)   =  0;
  Ja(4,1)   = -c(0);
  Ja(4,2)   = -s(0)*s(1);
  Ja(4,3)   =  c(0)*c(2)-c(1)*s(0)*s(2);
  Ja(4,4)   =  c(0)*s(2)*s(3)-c(3)*s(0)*s(1)+c(1)*c(2)*s(0)*s(3);
  Ja(4,5)   =  c(1)*c(4)*s(0)*s(2)-c(0)*c(2)*c(4)+c(0)*c(3)*s(2)*s(4)+s(0)*s(1)*s(3)*s(4)+c(1)*c(2)*c(3)*s(0)*s(4);
  Ja(4,6)   =  c(0)*c(5)*s(2)*s(3)-c(3)*c(5)*s(0)*s(1)-c(0)*c(2)*s(4)*s(5)+c(1)*s(0)*s(2)*s(4)*s(5)-c(4)*s(0)*s(1)*s(3)*s(5)+c(1)*c(2)*c(5)*s(0)*s(3)-c(0)*c(3)*c(4)*s(2)*s(5)-c(1)*c(2)*c(3)*c(4)*s(0)*s(5);
  Ja(5,0)   =  1;
  Ja(5,1)   =  0;
  Ja(5,2)   =  c(1);
  Ja(5,3)   = -s(1)*s(2);
  Ja(5,4)   =  c(1)*c(3)+c(2)*s(1)*s(3);
  Ja(5,5)   =  c(4)*s(1)*s(2)-c(1)*s(3)*s(4)+c(2)*c(3)*s(1)*s(4);
  Ja(5,6)   =  c(1)*c(3)*c(5)+c(2)*c(5)*s(1)*s(3)+c(1)*c(4)*s(3)*s(5)+s(1)*s(2)*s(4)*s(5)-c(2)*c(3)*c(4)*s(1)*s(5);

  return Ja;
}
